var PagesSwipe,Page1Scroll,TabsScroll,$tabs,activeNav,$mask,body;var tab_press_call=false;var pullDownEl,pullDownOffset,generatedCount=0;var CurrentPageScroll;var current_tab=1;var swapping=false;var $page_elems;var $wraper_pages;$(document).on("ready",function(){document.addEventListener("touchmove",function(i){i.preventDefault()},false);var h=$(".toggle-slide-left"),b=$(".close-menu");body=document.body;$mask=$("<div class='mask'></div>");h.on("tap",showSideMenu);$mask.on("tap",hideSideMenu);b.on("tap",hideSideMenu);var j=getViewportSize("w");$page_elems=$(".page");$wraper_pages=$(".pages");$tabs=$("ul.tabs").find("li");var d=0;$wraper_pages.css("width",$page_elems.length*j);$page_elems.css("width",j);$page_elems.css("height",getViewportSize("h")-100);mobileScroll("#page"+current_tab);for(var f=$tabs.length-1;f>=0;f--){var e=$tabs[f];var a=new Hammer(e);a.on("tap",pressTab);console.log("tab_p"+(f+1)+" :: "+$tabs.eq(f).innerWidth());d+=$tabs.eq(f).innerWidth()}var c=$page_elems.length+10;$("ul.tabs").css("width",d+c);var k=document.querySelector("#wrapper");var g=new Hammer(k);g.on("swipeleft",function(l){if(current_tab<$page_elems.length){var i=getViewportSize("w")*current_tab;mover($wraper_pages,i,"easeOutQuart","left",pruebita)}});g.on("swiperight",function(m){if(current_tab>1){var l=getXOffset($wraper_pages);var i=Math.abs(l)-getViewportSize("w");mover($wraper_pages,i,"easeOutQuart","right",pruebita)}});TabsScroll=new IScroll(".sub-header-bar",{eventPassthrough:true,scrollX:true,scrollY:false,preventDefault:false});$(window).on("resize",function(){j=getViewportSize("w");$wraper_pages.css("width",$page_elems.length*j);$page_elems.css("width",j);$page_elems.css("height",getViewportSize("h")-100)})});function pruebita(){console.log("callback del complete");console.log("estamos en el page:"+current_tab)}function mover(b,f,e,a,c){var d=a||"none";if(swapping===false){swapping=true;b.animate({transform:"translate("+(-f)+"px)"},{easing:e,queue:false,duration:270,start:function(){if(d=="left"){current_tab++}else{if(d=="right"){current_tab--}}if(d!=="none"){selectTab(current_tab)}},done:function(){swapping=false;var g="#"+$page_elems.get(current_tab-1).id;mobileScroll(g);$(".title").text(current_tab)},complete:c})}}function mobileScroll(a){CurrentPageScroll=new IScroll(a,{onRefresh:function(){if(pullDownEl.className.match("loading")){pullDownEl.className="";pullDownEl.querySelector(".pullDownLabel").innerHTML="Pull down to refresh..."}else{if(pullUpEl.className.match("loading")){pullUpEl.className="";pullUpEl.querySelector(".pullUpLabel").innerHTML="Pull up to load more..."}}},onScrollMove:function(){if(this.y>5&&!pullDownEl.className.match("flip")){pullDownEl.className="flip";pullDownEl.querySelector(".pullDownLabel").innerHTML="Release to refresh...";this.minScrollY=0}else{if(this.y<5&&pullDownEl.className.match("flip")){pullDownEl.className="";pullDownEl.querySelector(".pullDownLabel").innerHTML="Pull down to refresh...";this.minScrollY=-pullDownOffset}else{if(this.y<(this.maxScrollY-5)&&!pullUpEl.className.match("flip")){pullUpEl.className="flip";pullUpEl.querySelector(".pullUpLabel").innerHTML="Release to refresh...";this.maxScrollY=this.maxScrollY}else{if(this.y>(this.maxScrollY+5)&&pullUpEl.className.match("flip")){pullUpEl.className="";pullUpEl.querySelector(".pullUpLabel").innerHTML="Pull up to load more...";this.maxScrollY=pullUpOffset}}}}},onScrollEnd:function(){if(pullDownEl.className.match("flip")){pullDownEl.className="loading";pullDownEl.querySelector(".pullDownLabel").innerHTML="Loading...";pullDownAction()}else{if(pullUpEl.className.match("flip")){pullUpEl.className="loading";pullUpEl.querySelector(".pullUpLabel").innerHTML="Loading...";pullUpAction()}}}})}function getViewportSize(a){if(a==="w"){return Math.max(document.documentElement.clientWidth,window.innerWidth||0)}else{if(a==="h"){return Math.max(document.documentElement.clientHeight,window.innerHeight||0)}}}function underline_tab(a){$el_li=$tabs.eq(a);$el_li.siblings().removeClass("activo");$el_li.addClass("activo")}function selectTab(a){if(a>0){a--}underline_tab(a);$el_li=$tabs.eq(a);if(!$el_li.isOnScreen()){console.log("entra");updateTabViewport(a)}}function getXOffset(c){var a=c.css("transform");if(a=="none"){return 0}var b=a.substring(a.indexOf("(")+1,a.indexOf(")"));return Math.abs(b.split(",")[4])}function pressTab(g){if(swapping===false){var f=$tabs.filter("#"+g.target.id);current_tab=f.index()+1;underline_tab(f.index());f.addClass("activo").siblings().removeClass("activo");var a=$tabs.filter("#"+g.target.id).attr("data-page");var d=$page_elems.filter("#"+a);var b=d.offset().left;var c=getXOffset($wraper_pages)+b;console.log(a+" left:"+b);console.log(getXOffset($wraper_pages));mover($wraper_pages,c,"easeOutQuart")}}function updateTabViewport(a){TabsScroll.scrollToElement("#tab_p"+(a+1),null,true,null)}function showSideMenu(){body.classList.add("sml-open");body.appendChild($mask.get(0));activeNav="sml-open"}function hideSideMenu(){body.classList.remove(activeNav);activeNav="";body.removeChild($mask.get(0))};