var PagesSwipe,Page1Scroll,TabsScroll,$tabs,activeNav,$mask,body;var tab_press_call=false;var pullDownEl,pullDownOffset,generatedCount=0;var CurrentPageScroll;var swapping=false;var $page_elems;var $wraper_pages;var MobileApp={current_tab:1,ancho_container_tabs:0,init:function(){this.width_screen=this.getViewportSize("w");this.$body=$("body");this.$mask=$("<div class='mask'></div>");this.$page_elems=$(".page");this.$wraper_pages=$(".pages");this.$toggleSlideLeft=$(".toggle-slide-left");this.$close_menu=$(".close-menu");this.$tabs=$("ul.tabs").find("li");this.$wraper_pages.css("width",this.$page_elems.length*this.width_screen);this.$page_elems.css("width",this.width_screen);this.$page_elems.css("height",this.getViewportSize("h")-100);bind_gestures();mobileScroll("#page"+current_tab)},bind_gestures:function(){for(var b=this.$tabs.length-1;b>=0;b--){var a=this.$tabs[b];var c=new Hammer(a);c.on("tap",pressTab);console.log("tab_p"+(b+1)+" :: "+$tabs.eq(b).innerWidth());ancho_container_tabs+=$tabs.eq(b).innerWidth()}},getViewportSize:function(a){if(a==="w"){return Math.max(document.documentElement.clientWidth,window.innerWidth||0)}else{if(a==="h"){return Math.max(document.documentElement.clientHeight,window.innerHeight||0)}}},aplyVerticalScroll:function(a){CurrentPageScroll=new IScroll(a)}};$(document).on("ready",function(){MobileApp.init();document.addEventListener("touchmove",function(g){g.preventDefault()},false);MobileApp.$toggleSlideLeft.on("tap",showSideMenu);MobileApp.$mask.on("tap",hideSideMenu);MobileApp.$close_menu.on("tap",hideSideMenu);for(var c=$tabs.length-1;c>=0;c--){var b=$tabs[c];var f=new Hammer(b);f.on("tap",pressTab);console.log("tab_p"+(c+1)+" :: "+$tabs.eq(c).innerWidth());ancho_container_tabs+=$tabs.eq(c).innerWidth()}var d=$page_elems.length+10;$("ul.tabs").css("width",ancho_container_tabs+d);var a=document.querySelector("#wrapper");var e=new Hammer(a);e.on("swipeleft",function(h){if(current_tab<$page_elems.length){var g=getViewportSize("w")*current_tab;mover($wraper_pages,g,"easeOutQuart","left",pruebita)}});e.on("swiperight",function(i){if(current_tab>1){var h=getXOffset($wraper_pages);var g=Math.abs(h)-getViewportSize("w");mover($wraper_pages,g,"easeOutQuart","right",pruebita)}});TabsScroll=new IScroll(".sub-header-bar",{eventPassthrough:true,scrollX:true,scrollY:false,preventDefault:false});$(window).on("resize",function(){width_screen=getViewportSize("w");$wraper_pages.css("width",$page_elems.length*width_screen);$page_elems.css("width",width_screen);$page_elems.css("height",getViewportSize("h")-100)})});function pruebita(){console.log("callback del complete");console.log("estamos en el page:"+current_tab)}function mover(b,f,e,a,c){var d=a||"none";if(swapping===false){swapping=true;b.animate({transform:"translate("+(-f)+"px)"},{easing:e,queue:false,duration:270,start:function(){if(d=="left"){current_tab++}else{if(d=="right"){current_tab--}}if(d!=="none"){selectTab(current_tab)}},done:function(){swapping=false;var g="#"+$page_elems.get(current_tab-1).id;mobileScroll(g);$(".title").text(current_tab)},complete:c})}}function mobileScroll(a){CurrentPageScroll=new IScroll(a,{onRefresh:function(){if(pullDownEl.className.match("loading")){pullDownEl.className="";pullDownEl.querySelector(".pullDownLabel").innerHTML="Pull down to refresh..."}else{if(pullUpEl.className.match("loading")){pullUpEl.className="";pullUpEl.querySelector(".pullUpLabel").innerHTML="Pull up to load more..."}}},onScrollMove:function(){if(this.y>5&&!pullDownEl.className.match("flip")){pullDownEl.className="flip";pullDownEl.querySelector(".pullDownLabel").innerHTML="Release to refresh...";this.minScrollY=0}else{if(this.y<5&&pullDownEl.className.match("flip")){pullDownEl.className="";pullDownEl.querySelector(".pullDownLabel").innerHTML="Pull down to refresh...";this.minScrollY=-pullDownOffset}else{if(this.y<(this.maxScrollY-5)&&!pullUpEl.className.match("flip")){pullUpEl.className="flip";pullUpEl.querySelector(".pullUpLabel").innerHTML="Release to refresh...";this.maxScrollY=this.maxScrollY}else{if(this.y>(this.maxScrollY+5)&&pullUpEl.className.match("flip")){pullUpEl.className="";pullUpEl.querySelector(".pullUpLabel").innerHTML="Pull up to load more...";this.maxScrollY=pullUpOffset}}}}},onScrollEnd:function(){if(pullDownEl.className.match("flip")){pullDownEl.className="loading";pullDownEl.querySelector(".pullDownLabel").innerHTML="Loading...";pullDownAction()}else{if(pullUpEl.className.match("flip")){pullUpEl.className="loading";pullUpEl.querySelector(".pullUpLabel").innerHTML="Loading...";pullUpAction()}}}})}function underline_tab(a){$el_li=$tabs.eq(a);$el_li.siblings().removeClass("activo");$el_li.addClass("activo")}function selectTab(a){if(a>0){a--}underline_tab(a);$el_li=$tabs.eq(a);if(!$el_li.isOnScreen()){console.log("entra");updateTabViewport(a)}}function getXOffset(c){var a=c.css("transform");if(a=="none"){return 0}var b=a.substring(a.indexOf("(")+1,a.indexOf(")"));return Math.abs(b.split(",")[4])}function pressTab(g){if(swapping===false){var f=$tabs.filter("#"+g.target.id);current_tab=f.index()+1;underline_tab(f.index());f.addClass("activo").siblings().removeClass("activo");var a=$tabs.filter("#"+g.target.id).attr("data-page");var d=$page_elems.filter("#"+a);var b=d.offset().left;var c=getXOffset($wraper_pages)+b;console.log(a+" left:"+b);console.log(getXOffset($wraper_pages));mover($wraper_pages,c,"easeOutQuart")}}function updateTabViewport(a){TabsScroll.scrollToElement("#tab_p"+(a+1),null,true,null)}function showSideMenu(){body.classList.add("sml-open");body.appendChild($mask.get(0));activeNav="sml-open"}function hideSideMenu(){body.classList.remove(activeNav);activeNav="";body.removeChild($mask.get(0))};